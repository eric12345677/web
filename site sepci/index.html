<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Classic Baseball Cap</title>
    <link rel="preconnect" href="https://js.stripe.com" />
    <style>
      :root {
        --bg: #0b0c10;
        --panel: #111318;
        --muted: #9aa3af;
        --text: #e5e7eb;
        --brand: #7c3aed;
        --accent: #16a34a;
        --danger: #ef4444;
        --border: #23262d;
        --shadow: 0 10px 25px rgba(0, 0, 0, 0.35);
      }
      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        background: radial-gradient(1200px 800px at 80% -20%, rgba(124, 58, 237, 0.15), transparent),
                    radial-gradient(900px 700px at -10% 10%, rgba(34, 197, 94, 0.10), transparent),
                    var(--bg);
        color: var(--text);
        font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      }
      .container {
        max-width: 1100px;
        margin: 0 auto;
        padding: 24px;
      }
      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 0 28px;
      }
      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 700;
        letter-spacing: 0.3px;
      }
      .brand .dot {
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--brand), #22c55e);
        box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.15);
      }
      .cart-button {
        position: relative;
        background: transparent;
        border: 1px solid var(--border);
        color: var(--text);
        padding: 10px 14px;
        border-radius: 10px;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      .cart-button:hover { border-color: #2f3440; background: #0f1116; }
      .cart-count {
        position: absolute;
        top: -8px;
        right: -8px;
        background: var(--brand);
        color: white;
        border-radius: 999px;
        min-width: 22px;
        height: 22px;
        font-size: 12px;
        display: grid;
        place-items: center;
        padding: 0 6px;
        box-shadow: var(--shadow);
      }
      .grid {
        display: grid;
        grid-template-columns: 1.2fr 1fr;
        gap: 28px;
      }
      @media (max-width: 900px) {
        .grid { grid-template-columns: 1fr; }
      }
      .panel {
        background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.0)), var(--panel);
        border: 1px solid var(--border);
        border-radius: 16px;
        box-shadow: var(--shadow);
      }
      .media {
        padding: 28px;
      }
      .cap-frame {
        background: radial-gradient(600px 200px at 50% 0%, rgba(124,58,237,0.10), transparent), #0f1116;
        border: 1px solid #1d2027;
        border-radius: 14px;
        height: 420px;
        display: grid;
        place-items: center;
      }
      .details { padding: 28px; }
      h1 { margin: 0 0 8px; font-size: 28px; }
      .subtitle { color: var(--muted); margin-bottom: 18px; }
      .price {
        font-size: 24px;
        font-weight: 700;
        margin: 8px 0 18px;
      }
      .swatches {
        display: flex;
        gap: 12px;
        margin: 12px 0 6px;
      }
      .swatch {
        width: 34px;
        height: 34px;
        border-radius: 999px;
        border: 2px solid var(--border);
        cursor: pointer;
        outline: none;
        transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
      }
      .swatch:hover { transform: translateY(-2px); }
      .swatch.active { box-shadow: 0 0 0 4px rgba(124,58,237,0.25); border-color: var(--brand); }
      .row { display: flex; align-items: center; gap: 12px; margin: 18px 0; }
      .qty {
        display: inline-flex;
        align-items: center;
        border: 1px solid var(--border);
        border-radius: 10px;
        overflow: hidden;
      }
      .qty button {
        background: #151922;
        color: var(--text);
        border: none;
        width: 36px;
        height: 38px;
        cursor: pointer;
      }
      .qty input {
        width: 56px;
        height: 38px;
        background: #0f1116;
        color: var(--text);
        border: none;
        text-align: center;
      }
      .primary {
        appearance: none;
        background: linear-gradient(180deg, #8b5cf6, #7c3aed);
        color: white;
        border: none;
        padding: 12px 18px;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 700;
        box-shadow: 0 10px 22px rgba(124,58,237,0.35);
      }
      .secondary {
        appearance: none;
        background: transparent;
        color: var(--text);
        border: 1px solid var(--border);
        padding: 12px 16px;
        border-radius: 10px;
        cursor: pointer;
      }
      .muted { color: var(--muted); }
      .divider { height: 1px; background: var(--border); margin: 18px 0; }

      /* Cart Drawer */
      .cart {
        position: fixed;
        top: 0;
        right: 0;
        width: min(420px, 92vw);
        height: 100vh;
        background: var(--panel);
        border-left: 1px solid var(--border);
        box-shadow: var(--shadow);
        transform: translateX(110%);
        transition: transform 0.25s ease;
        display: flex;
        flex-direction: column;
        z-index: 50;
      }
      .cart.open { transform: translateX(0); }
      .cart .cart-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 18px 18px;
        border-bottom: 1px solid var(--border);
      }
      .cart .items { flex: 1; overflow: auto; padding: 6px 14px 14px; }
      .item {
        display: grid;
        grid-template-columns: 56px 1fr auto;
        gap: 12px;
        padding: 12px;
        border: 1px solid var(--border);
        border-radius: 12px;
        margin: 10px 0;
        background: #0f1116;
      }
      .item .thumb { width: 56px; height: 56px; border-radius: 8px; border: 1px solid var(--border); }
      .item .title { font-weight: 700; }
      .item .meta { color: var(--muted); font-size: 13px; }
      .item .actions { display: flex; align-items: center; gap: 8px; }
      .cart .footer { padding: 14px; border-top: 1px solid var(--border); }
      .total-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
      .danger { color: var(--danger); cursor: pointer; }
      a.clean { color: inherit; text-decoration: none; }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="brand"><span class="dot"></span>Caps Co.</div>
        <button id="openCart" class="cart-button" aria-label="Open cart">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M6 6h15l-1.5 9h-12L6 6Z" stroke="currentColor" stroke-width="1.5"/><path d="M6 6 5 3H3" stroke="currentColor" stroke-width="1.5"/><circle cx="9" cy="19" r="1.5" fill="currentColor"/><circle cx="17" cy="19" r="1.5" fill="currentColor"/></svg>
          <span>Cart</span>
          <span id="cartCount" class="cart-count">0</span>
        </button>
      </header>

      <div class="grid">
        <section class="panel media">
          <div class="cap-frame">
            <!-- Simple stylized cap SVG; color is controlled by CSS variable set via JS -->
            <svg id="capSvg" width="420" height="240" viewBox="0 0 420 240" xmlns="http://www.w3.org/2000/svg" aria-label="Baseball cap preview">
              <defs>
                <linearGradient id="shade" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0%" stop-color="#ffffff22"/>
                  <stop offset="100%" stop-color="#00000022"/>
                </linearGradient>
              </defs>
              <g transform="translate(10,10)">
                <path id="capCrown" d="M40 120c0-60 60-110 150-110s150 50 150 110c0 0-38 8-150 8S40 120 40 120Z" fill="#cc0000"/>
                <path d="M40 120c0-60 60-110 150-110s150 50 150 110c0 0-38 8-150 8S40 120 40 120Z" fill="url(#shade)"/>
                <path id="capBill" d="M118 132c-36 7-76 27-98 46-11 10-9 22 7 22h210c40 0 65-12 79-21 9-6 9-17-3-21-61-20-119-27-195-26Z" fill="#b30000"/>
                <path d="M118 132c-36 7-76 27-98 46-11 10-9 22 7 22h210c40 0 65-12 79-21 9-6 9-17-3-21-61-20-119-27-195-26Z" fill="url(#shade)"/>
              </g>
            </svg>
          </div>
        </section>

        <section class="panel details">
          <h1>Classic Baseball Cap</h1>
          <div class="subtitle">One premium cap. Three bold colors.</div>
          <div class="price">$<span id="priceText">25.00</span> USD</div>
          <div>
            <div class="muted">Color</div>
            <div class="swatches" role="tablist" aria-label="Select color">
              <button class="swatch active" id="swatch-red" role="tab" aria-selected="true" aria-controls="tab-red" title="Red" style="background:#cc0000"></button>
              <button class="swatch" id="swatch-black" role="tab" aria-selected="false" aria-controls="tab-black" title="Black" style="background:#111418"></button>
              <button class="swatch" id="swatch-green" role="tab" aria-selected="false" aria-controls="tab-green" title="Green" style="background:#0b6b2b"></button>
            </div>
          </div>
          <div class="row">
            <div class="qty" aria-label="Quantity">
              <button id="decQty" aria-label="Decrease quantity">âˆ’</button>
              <input id="qty" type="number" min="1" value="1" inputmode="numeric" />
              <button id="incQty" aria-label="Increase quantity">+</button>
            </div>
            <button id="addToCart" class="primary">Add to cart</button>
            <button id="buyNow" class="secondary">Buy now</button>
          </div>
          <div class="divider"></div>
          <div class="muted">Free shipping over $50. 30-day returns. Comfortable, breathable, and built to last.</div>
        </section>
      </div>
    </div>

    <!-- Cart Drawer -->
    <aside id="cart" class="cart" aria-hidden="true" aria-label="Shopping cart">
      <div class="cart-header">
        <div style="font-weight:700">Your cart</div>
        <button id="closeCart" class="secondary">Close</button>
      </div>
      <div id="cartItems" class="items"></div>
      <div class="footer">
        <div class="total-row">
          <div class="muted">Subtotal</div>
          <div id="subtotal" style="font-weight:700">$0.00</div>
        </div>
        <div class="row" style="margin: 0; gap: 10px;">
          <button id="clearCart" class="secondary" style="flex:1">Clear</button>
          <button id="checkout" class="primary" style="flex:2">Checkout with Stripe</button>
        </div>
      </div>
    </aside>

    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3"></script>
    <script>
      // ===== Stripe + Product Configuration =====
      // Replace the publishable key and price IDs below with your own from the Stripe Dashboard:
      // - Create one Product with three Prices (red, black, green)
      // - Copy the price IDs (e.g., price_123...) into the map below
      // - Set SUCCESS_URL and CANCEL_URL to routes you control
      const STRIPE_PUBLISHABLE_KEY = 'pk_test_REPLACE_ME';
      const STRIPE_PRICE_IDS = { red: 'price_REPLACE_RED', black: 'price_REPLACE_BLACK', green: 'price_REPLACE_GREEN' };
      const SUCCESS_URL = 'http://localhost:5500/success.html';
      const CANCEL_URL = 'http://localhost:5500/cancel.html';

      const PRODUCT_PRICE_USD = 25.00; // Display only; the real charge comes from Stripe Prices

      let stripe = null;
      if (typeof Stripe === 'function' && STRIPE_PUBLISHABLE_KEY && STRIPE_PUBLISHABLE_KEY.startsWith('pk_')) {
        try { stripe = Stripe(STRIPE_PUBLISHABLE_KEY); } catch (e) { /* ignored */ }
      }

      // ===== Simple Store State =====
      const state = {
        selectedColor: 'red',
        cart: { red: 0, black: 0, green: 0 }
      };

      // ===== Helpers =====
      const fmt = (n) => `$${n.toFixed(2)}`;
      const totalItems = () => state.cart.red + state.cart.black + state.cart.green;
      const calcSubtotal = () => PRODUCT_PRICE_USD * totalItems();
      const colorName = (key) => ({ red: 'Red', black: 'Black', green: 'Green' }[key] || key);

      // ===== UI Elements =====
      const cartEl = document.getElementById('cart');
      const cartItemsEl = document.getElementById('cartItems');
      const subtotalEl = document.getElementById('subtotal');
      const cartCountEl = document.getElementById('cartCount');
      const addToCartBtn = document.getElementById('addToCart');
      const buyNowBtn = document.getElementById('buyNow');
      const qtyInput = document.getElementById('qty');
      const priceText = document.getElementById('priceText');
      const capSvgCrown = document.getElementById('capCrown');
      const capSvgBill = document.getElementById('capBill');

      // ===== Color Selection =====
      const colorToHex = { red: '#cc0000', black: '#111418', green: '#0b6b2b' };
      const setColor = (color) => {
        state.selectedColor = color;
        document.querySelectorAll('.swatch').forEach((el) => el.classList.remove('active'));
        const sw = document.getElementById(`swatch-${color}`);
        if (sw) sw.classList.add('active');
        const hex = colorToHex[color] || '#cc0000';
        capSvgCrown.setAttribute('fill', hex);
        capSvgBill.setAttribute('fill', shade(hex, -10));
      };
      // Simple color shade util
      function shade(hex, percent) {
        const f = parseInt(hex.slice(1), 16);
        const t = percent < 0 ? 0 : 255;
        const p = Math.abs(percent) / 100;
        const R = f >> 16, G = (f >> 8) & 0x00ff, B = f & 0x0000ff;
        const nr = Math.round((t - R) * p) + R;
        const ng = Math.round((t - G) * p) + G;
        const nb = Math.round((t - B) * p) + B;
        return `#${(0x1000000 + (nr << 16) + (ng << 8) + nb).toString(16).slice(1)}`;
      }

      // ===== Cart Rendering =====
      function renderCart() {
        cartItemsEl.innerHTML = '';
        const entries = Object.entries(state.cart).filter(([_, q]) => q > 0);
        if (entries.length === 0) {
          cartItemsEl.innerHTML = `<div class="muted" style="text-align:center; padding: 32px 0;">Your cart is empty.</div>`;
        } else {
          for (const [color, quantity] of entries) {
            const item = document.createElement('div');
            item.className = 'item';
            const thumb = document.createElement('div');
            thumb.className = 'thumb';
            thumb.style.background = colorToHex[color] || '#222';
            const mid = document.createElement('div');
            const title = document.createElement('div');
            title.className = 'title';
            title.textContent = `Classic Baseball Cap`;
            const meta = document.createElement('div');
            meta.className = 'meta';
            meta.textContent = `${colorName(color)} â€¢ ${fmt(PRODUCT_PRICE_USD)} each`;
            mid.appendChild(title);
            mid.appendChild(meta);
            const actions = document.createElement('div');
            actions.className = 'actions';
            const dec = document.createElement('button'); dec.className = 'secondary'; dec.textContent = 'âˆ’';
            const qty = document.createElement('div'); qty.className = 'muted'; qty.style.minWidth = '28px'; qty.style.textAlign = 'center'; qty.textContent = quantity;
            const inc = document.createElement('button'); inc.className = 'secondary'; inc.textContent = '+';
            const remove = document.createElement('a'); remove.className = 'danger clean'; remove.href = '#'; remove.textContent = 'Remove';
            dec.onclick = () => { updateQty(color, Math.max(0, quantity - 1)); };
            inc.onclick = () => { updateQty(color, quantity + 1); };
            remove.onclick = (e) => { e.preventDefault(); updateQty(color, 0); };
            actions.appendChild(dec); actions.appendChild(qty); actions.appendChild(inc); actions.appendChild(remove);
            const lineTotal = document.createElement('div');
            lineTotal.style.fontWeight = '700';
            lineTotal.textContent = fmt(PRODUCT_PRICE_USD * quantity);
            item.appendChild(thumb);
            item.appendChild(mid);
            item.appendChild(actions);
            item.appendChild(lineTotal);
            cartItemsEl.appendChild(item);
          }
        }
        subtotalEl.textContent = fmt(calcSubtotal());
        cartCountEl.textContent = totalItems();
      }

      function updateQty(color, newQty) {
        state.cart[color] = newQty;
        renderCart();
      }

      // ===== Events =====
      document.getElementById('openCart').addEventListener('click', () => {
        cartEl.classList.add('open');
        cartEl.setAttribute('aria-hidden', 'false');
      });
      document.getElementById('closeCart').addEventListener('click', () => {
        cartEl.classList.remove('open');
        cartEl.setAttribute('aria-hidden', 'true');
      });
      document.getElementById('clearCart').addEventListener('click', () => {
        state.cart = { red: 0, black: 0, green: 0 };
        renderCart();
      });

      document.getElementById('swatch-red').addEventListener('click', () => setColor('red'));
      document.getElementById('swatch-black').addEventListener('click', () => setColor('black'));
      document.getElementById('swatch-green').addEventListener('click', () => setColor('green'));

      document.getElementById('decQty').addEventListener('click', () => {
        const n = Math.max(1, (parseInt(qtyInput.value, 10) || 1) - 1);
        qtyInput.value = String(n);
      });
      document.getElementById('incQty').addEventListener('click', () => {
        const n = Math.max(1, (parseInt(qtyInput.value, 10) || 1) + 1);
        qtyInput.value = String(n);
      });
      qtyInput.addEventListener('input', () => {
        const val = parseInt(qtyInput.value, 10);
        if (isNaN(val) || val < 1) qtyInput.value = '1';
      });

      addToCartBtn.addEventListener('click', () => {
        const qty = Math.max(1, parseInt(qtyInput.value, 10) || 1);
        const c = state.selectedColor;
        state.cart[c] += qty;
        renderCart();
        cartEl.classList.add('open');
        cartEl.setAttribute('aria-hidden', 'false');
      });

      buyNowBtn.addEventListener('click', () => {
        // Add selected qty of selected color and proceed to checkout
        const qty = Math.max(1, parseInt(qtyInput.value, 10) || 1);
        const c = state.selectedColor;
        state.cart[c] += qty;
        renderCart();
        handleCheckout();
      });

      document.getElementById('checkout').addEventListener('click', handleCheckout);

      async function handleCheckout() {
        const items = Object.entries(state.cart).filter(([_, q]) => q > 0);
        if (items.length === 0) {
          alert('Your cart is empty.');
          return;
        }
        const lineItems = [];
        for (const [color, quantity] of items) {
          const priceId = STRIPE_PRICE_IDS[color];
          if (!priceId || !priceId.startsWith('price_')) {
            alert('Stripe price IDs are not configured. Edit this file to add your real price IDs.');
            return;
          }
          lineItems.push({ price: priceId, quantity });
        }
        if (!stripe) {
          alert('Stripe publishable key is not set. Edit this file and replace STRIPE_PUBLISHABLE_KEY.');
          return;
        }
        try {
          const { error } = await stripe.redirectToCheckout({
            lineItems,
            mode: 'payment',
            successUrl: SUCCESS_URL,
            cancelUrl: CANCEL_URL,
          });
          if (error) {
            console.error(error);
            alert(error.message || 'Unable to redirect to Stripe Checkout.');
          }
        } catch (err) {
          console.error(err);
          alert('There was a problem starting checkout. Check the console for details.');
        }
      }

      // ===== Init =====
      function init() {
        priceText.textContent = PRODUCT_PRICE_USD.toFixed(2);
        setColor('red');
        renderCart();
      }
      init();
    </script>
  </body>
</html>


